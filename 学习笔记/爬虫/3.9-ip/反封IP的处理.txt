一、什么叫做反封IP处理
爬虫进行爬取的时候，目标服务器有可能对单位时间内爬取频率超过一定数值的IP进行禁止访问的处理，
绕过这种服务器防护手段，稳定的进行爬取，这种绕过的手段就叫反封IP处理

二、如何反封IP
1、降低频率
部分网站虽然有封IP的处理，但是可以降低爬取的频率，测试服务器的检测阀值，
如果在不触及服务器阀值的情况下，爬取速度能够满足我们的应用需求，那么就直接这么处理就好。
优点：简单，稳定
缺点：速度慢，效率低
原理：测试服务器的拒绝服务的阀值(server_test测试)
    有部分网站是没有做任何IP限制的，这种网站建议大家不要太狠，一般还是限制一个单位的访问次数，不然服务器会宕机
    得到阀值后，不让服务器检测到你异常，不断的增加延时的时间，判断单位时间内的最大访问次数
    譬如，你测算出服务器的允许时间是：1秒1次请求，然后你的爬虫任务是5秒完成一次，
    设置5个线程（协程）进行网络访问，每个任务计算消耗时间，如果低于5秒了，就延时

这种方式对于数据价值比较高的应用，是可取的，可以增加服务器来提高单位时间内的爬取数据

2、本机宽带拨号或使用拨号VPS
每次拨号后，会获得一个新的IP地址
通过代码或者第三方拨号软件定时拨号，更换机器IP
优点：较简单，成本低
缺点：拨号有时IP重复，需要多次拨号，效率较低
原理就是：
不管服务器的拒绝服务的阀值，遇到被限制了，就进行拨号，更换IP
一个宽带账号，是在一个固定的IP段内的，重复拨号，有可能连续拨到同一个IP（处理方式可以建立一个已使用的IP列表，拨号后进行检测）
严重的时候，会被服务器把IP段给封掉
一般来讲也不会太多的线程处理，过快拨号，会把系统弄宕机

连接了路由的机器，可以通过路由器的接口进行拨号处理

3、代理IP，最常用的方式
使用代理IP，不管是付费的还是免费的，都经常有获取的ip不能使用的情况
3.1、免费代理：使用程序从一些网站上搜索到免费代理IP，进行测试后，维护起来，形成一个IP池，不断地更新
优点：复杂，成本低
缺点：不稳定，效率稍低
原理：
就是在我们的requests包中，
session = requests.session()
session.proxy = 设置这个代理的ip和端口
代理IP的数据流（其实就是一个数据转发）：
发送： 本机发送一个http请求》》请求发送到代理IP的port，代理服务器做了处理后》》代理服务器发送到目标服务器
返回：目标服务器返回应答内容》》应答内容发送到代理服务器》》发送到本机

经过代理后的数据请求，在目标服务器（譬如百度）看来，访问它的机器的IP是代理服务器的IP地址，而不是你的本机IP

爬虫不使用代理软件，直接通过设置proxy进行代理ip的访问

代理IP转发你的http请求，是因为它机器上有代理服务的软件，会解析请求（只支持部分协议数据的解析），获得目标服务器，然后把数据发送过去


我们可以自己维护一个代理池：
1、通过爬虫，爬取 免费代理网站 上爬取免费的 代理IP和端口，
2、爬到的数据可以保存在内存、文件、数据库，保存的过程中需要对爬取到的IP和PORT进行去重
3、对新获取的IP和PORT，进行检测，检测的方式，根据你的当前的系统功能，设置proxy，
连接你的业务的目标服务器，看是否可以正常通信，检测可以根据不同的业务系统进行不同的检测
OK的保存到一个可以使用的IP列表中
不OK的，丢弃或者保存到另外一个异常IP列表中

维护的ip池信息
ip  port  获取时间  端口是否可用  projectA是否可用  projectB是否可用  是否已经检测过

4、业务系统运行时，从IP池中获取本系统可用的IP和PORT，设置为proxy，进行业务访问
5、当前IP和PORT异常后，丢弃或标志不可使，并重新获取可用的IP和端口

示例：
1台机器不断爬取代理IP和PORT信息，保存到数据库中，通过数据库进行去重，
可以使用获取代理的机器进行IP和PORT的检测，也可以单独开一台机器进行检测，
多台机器运行业务系统，不断从数据库中提取可用的代理IP和PORT

3.2、付费代理：通过网上一些代理IP服务商购买代理IP服务，使用提供的接口获取代理列表就行
优点：简单，稳定，效率高
缺点：成本高
原理：
代理提供商维护一批可用的IP地址，在你提取IP时，发送给你，稳定性根据不同的服务商不同

4、VPN
类似代理IP，但是没有代理IP方便

5、第三方云采集平台
由云采集平台帮你进行数据的爬取
优点：简单，方便
缺点：成本高，只能平台支持的数据
原理：
就是采集平台实现了爬虫，并且提供了一套界面工具给你编辑采集的流程，
平台的爬虫程序根据你设置的流程和规则，去爬取指定网站的指定内容
只能爬取简单的页面的


心得：
1、手动操作，次数多了一样会被封IP，一般封多长时间，譬如半小时，服务器也怕是误检测
2、反封IP就2种：1、不被检测出来，2、被检测了，更换IP